Phase 1: Foundation & Architecture (Weeks 1-2)

Goal: Establish the extension shell, storage engine, and side panel infrastructure.

    Build Setup: Initialize Monorepo with Vite/Webpack for separate Chrome (sidePanel) and Firefox (sidebar_action) manifests.

    Permissions: Request sidePanel, activeTab, scripting, storage, and unlimitedStorage.

    Database: Initialize Dexie.js with pages and notes tables.

    UI: Create "Hello World" side panel that displays the active tab's URL.

Phase 2: The Highlighter Core (Weeks 3-4)

Goal: Allow users to paint on the web page and persist the coordinates.

    Painting: Listen for mouseup, inject "Tooltip" with default colors, and render highlights using CSS.highlights or <span> wrapping.

    Context Capture: Capture exactText, prefix (30 chars), suffix (30 chars), and xpath.

    Persistence: Save anchor data to Dexie.js.

    Re-hydration: Implement fuzzy matching (XPath -> Context Search -> Levenshtein) to restore highlights on page load.

Phase 3: Visual Customization & Layer Logic (Weeks 5-6) [NEW]

Goal: Enable dynamic styling, custom palettes, and robust handling of overlapping highlights.

    Settings UI:

        Create a Settings page allowing users to add/remove HEX codes to their customPalette.

        Implement "Default Highlight Style" configuration (Solid vs. Underline, Opacity levels).

    Interactive Editing (The "On the Fly" Feature):

        Context Menu: Implement a custom right-click or hover menu on existing highlights to "Change Color" or "Delete".

        Live Updates: Ensure changing a color in the DOM immediately updates the specific record in Dexie.js without page reload.

    Advanced Collision UI:

        Upgrade the "Cluster Bubbles" (from Phase 2) to be interactive.

        Feature: Clicking a bubble in a stack focuses that layer; Right-clicking a bubble opens a color picker for that specific layer, allowing users to color-code nested ideas (e.g., Yellow sentence inside a Blue paragraph).

Phase 4: Note Management & Side Panel UI (Weeks 7-8)

Goal: Build the CRUD interface in the Side Panel.

    Note List: Query Dexie for current URL notes; render cards with snippets.

    Editor: Implement Tiptap/Slate.js (Bold, Italic, Link) with 500ms debounce auto-save.

    Bi-directional Nav:

        Panel->Page: Scroll to highlight.

        Page->Panel: Scroll to note card.

    Orphan UI: "Re-link" flow to repair broken anchors.

Phase 5: Tagging & Global Search (Weeks 9-10)

Goal: Turn isolated notes into a knowledge base.

    Tagging: Chip input in editor; index tags in Dexie.

    Dashboard: "Tags" view in Side Panel showing counts.

    Global Search: Search bar querying content, anchors, and tags across all URLs.

Phase 6: Global Dashboard & Deep Navigation (Weeks 11-12)

Goal: Create a central hub for all knowledge.

    Global Tab: "All Notes" view sorted by date with Virtual Scrolling.

    Deep Linking: Background script logic to find existing tabs or open new ones, then scroll to the note via URL hash or message polling.

Phase 7: AI Integration (Weeks 13-14)

 Goal: Add "Magic" features using Hybrid AI.

    Local: window.ai for Summarization and Auto-Tagging.

    Cloud: LangChain.js integration for "Ask Note" features with BYOK security.

Phase 8: Polish, Security & Release (Weeks 15-16)

Goal: Prepare for the Web Store.

    Portability: JSON Export/Import (Blob streaming).

    Performance: Move Fuzzy Matcher to Web Worker.

    Assets: Privacy Policy explicitly stating local storage.